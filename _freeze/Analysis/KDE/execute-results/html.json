{
  "hash": "d0261f666dad68a63e9ec4ac2504de9c",
  "result": {
    "markdown": "---\ntitle: \"KDE Analysis\"\nformat: html\ndate-modified: \"last-modified\"\nexecute:  \n  warning: false\n  freeze: true\n  message: false \n  eval: true \n  echo: true \n  fig-retine: 3\ndate: \"2024-04-14\"\n---\n\n\n# 1. Getting Started\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, sfdep, tmap, tidyverse, knitr, GWmodel, dplyr, plotly, arrow, lubridate, sf, tmap, maptools, sp, raster, spatstat, spNetwork, classInt, viridis, readr)\n```\n:::\n\n\n# 2. Loading the Packages\n\n## 2.1 Loading Apatial Data\n\nThis dataset is the Waste Less - Recycable Collection Point Data from data.gov.hk that contains all the different recycling points in Hong Kong.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncp <- read_csv(\"data/aspatial/hkrecyclepoints.csv\")\n```\n:::\n\n\n## 2.2 Loading Geospatial Data\n\nThis dataset is from Hong Kong CSDI which contains all the 18 districts in Hong Kong.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistrict_18 <- st_read(dsn = \"data/geospatial/hk_18Districts/\",\n                      layer = \"HKDistrict18\" )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `HKDistrict18' from data source \n  `C:\\Users\\Kachel Lee\\ka33rina\\IS415-project\\Analysis\\data\\geospatial\\hk_18Districts' \n  using driver `ESRI Shapefile'\nSimple feature collection with 18 features and 4 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 12672060 ymin: 2529946 xmax: 12739620 ymax: 2579129\nProjected CRS: WGS 84 / Pseudo-Mercator\n```\n:::\n:::\n\n\n# 3. Transforming Coordinate System\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsf_district_18 <- st_transform(district_18, crs = 2326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncp_sf <- st_as_sf(cp, \n                  coords = c(\"lgt\",\"lat\"), \n                  crs = 4326) %>%\n  st_transform(crs=2326)\n```\n:::\n\n\n## 3.1 Transforming cp_sf to sf and ppp format\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncp_sf <- cp_sf %>%\n  st_union()\n\ncp_sf <- cp_sf %>% st_transform(crs = 2326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncp_ppp <- as.ppp(cp_sf)\n```\n:::\n\n\nConverting sf format for cp into spatial class the sp format because you cannot do it directly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncp <- as_Spatial(cp_sf)\n```\n:::\n\n\nSpatstat requires the analytical data to be in ppp object form, but since there is no way to directly convert a Spatial\\* classes into ppp object, we’ll need to convert the Spatial\\* classes into a generic Spatial object first, then convert the generic sp object into ppp object form.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncp_sp <- as(cp, \"SpatialPoints\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncp_ppp <- as(cp_sp, \"ppp\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncp_ppp_jit <- rjitter(cp_ppp, \n                          retry=TRUE, \n                          nsim=1, \n                          drop=TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nany(duplicated(cp_ppp_jit))\n```\n:::\n\n\n## 3.2 Transforming district_18 to sf and ppp format\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistrict_18_transform <- district_18 %>%\n  st_transform(crs = 2326)\n```\n:::\n\n\nConverting sf format for district_18_transform into spatial class the sp format because you cannot do it directly here as well.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistrict_18_sp <- as_Spatial(district_18_transform)\n```\n:::\n\n\nAs mentioned earlier, spatstat requires the analytical data to be in ppp object form, but since there is no way to directly convert a Spatial\\* classes into ppp object, we’ll need to convert the Spatial\\* classes into a generic Spatial object first, then convert the generic sp object into ppp object form.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistrict_18_sp<-as(district_18_sp, \"SpatialPolygons\")\n```\n:::\n\n\nI am confining the analysis with a geographical area. In spatstat, the object called owin is specially designed to represent this polygonal region. This produces the Hong Kong's districts boundary layers. We will be doing these same steps for Wan Chai, Sha Tin and Yau Tsim Mong districts later.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistrict_18_owin<-as(district_18_sp, \"owin\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_cp_ppp <- cp_ppp_jit[district_18_owin]\n```\n:::\n\n\nhk_ppp.km contains all the recycling points in Hong Kong\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_ppp.km <- rescale(hk_cp_ppp, 1000, \"km\")\n```\n:::\n\n\n# 4. KDE on Wan Chai\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchai <- district_18 %>%\n  filter(ENAME == \"WAN CHAI\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchai <- wanchai %>%\n  st_transform(crs = 2326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchai <- as_Spatial(wanchai)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchai_sp <- as(wanchai, \"SpatialPolygons\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchai_owin <- as(wanchai_sp, \"owin\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_ppp_jit <- rjitter(hk_cp_ppp, \n                      retry=TRUE, \n                      nsim=1, \n                      drop=TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_wanchai_ppp <- hk_ppp_jit[wanchai_owin]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_wanchai_ppp.km = rescale(hk_wanchai_ppp, 1000, \"km\")\n```\n:::\n\n\nWe will be doing KDE for different kernel smoothing methods, Gaussian, Epanechnikov, Quartic and Disc for Wan Chai, Sha Tin and Yau Tsim Mong respectively. Different smoothing methods are suitable for different types of data and applications.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchaigaussian <- density(hk_wanchai_ppp.km, \n             sigma=bw.ppl, \n             edge=TRUE, \n             kernel=\"gaussian\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(wanchaigaussian, file = \"data/rds/wanchaigaussian.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchaigaussian <- read_rds(\"data/rds/wanchaigaussian.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchaiepanechnikov <- density(hk_wanchai_ppp.km, \n                                    sigma=bw.ppl, \n                                    edge=TRUE, \n                                    kernel=\"epanechnikov\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(wanchaiepanechnikov, file = \"/Users/fangqilim/fangqi611/IS415-project/daylightapp/data/rds/wanchaiepanechnikov.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchaiepanechnikov <- read_rds(\"data/rds/wanchaiepanechnikov.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchaiquartic <- density(hk_wanchai_ppp.km, \n                               sigma=bw.ppl, \n                               edge=TRUE, \n                               kernel=\"quartic\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(wanchaiquartic, file = \"/Users/fangqilim/fangqi611/IS415-project/daylightapp/data/rds/wanchaiquartic.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchaiquartic <- read_rds(\"data/rds/wanchaiquartic.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchaidisc <- density(hk_wanchai_ppp.km, \n                          sigma=bw.ppl, \n                          edge=TRUE, \n                          kernel=\"disc\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(wanchaidisc, file = \"data/rds/wanchaidisc.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwanchaidisc <- read_rds(\"data/rds/wanchaidisc.rds\")\n```\n:::\n\n\n# 5. KDE on Sha Tin\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshatin <- district_18 %>%\n  filter(ENAME == \"SHA TIN\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatin <- shatin %>%\n  st_transform(crs = 2326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatin <- as_Spatial(shatin)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatin_sp <- as(shatin, \"SpatialPolygons\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatin_owin <- as(shatin_sp, \"owin\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_ppp_jit <- rjitter(hk_cp_ppp, \n                      retry=TRUE, \n                      nsim=1, \n                      drop=TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_shatin_ppp = hk_ppp_jit[shatin_owin]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_shatin_ppp.km = rescale(hk_shatin_ppp, 1000, \"km\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatingaussian <- density(hk_shatin_ppp.km, \n                           sigma=bw.ppl, \n                           edge=TRUE, \n                           kernel=\"gaussian\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(shatingaussian, file = \"/Users/fangqilim/fangqi611/IS415-project/daylightapp/data/rds/shatingaussian.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatingaussian <- read_rds(\"data/rds/shatingaussian.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatinepanechnikov <- density(hk_shatin_ppp.km, \n                               sigma=bw.ppl, \n                               edge=TRUE, \n                               kernel=\"epanechnikov\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(shatinepanechnikov, file = \"data/rds/shatinepanechnikov.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatinepanechnikov <- read_rds(\"data/rds/shatinepanechnikov.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatinquartic <- density(hk_shatin_ppp.km, \n                          sigma=bw.ppl, \n                          edge=TRUE, \n                          kernel=\"quartic\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(shatinquartic, file = \"/Users/fangqilim/fangqi611/IS415-project/daylightapp/data/rds/shatinquartic.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatinquartic <- read_rds(\"data/rds/shatinquartic.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatindisc <- density(hk_shatin_ppp.km, \n                       sigma=bw.ppl, \n                       edge=TRUE, \n                       kernel=\"disc\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(shatindisc, file = \"/Users/fangqilim/fangqi611/IS415-project/daylightapp/data/rds/shatindisc.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nshatindisc <- read_rds(\"data/rds/shatindisc.rds\")\n```\n:::\n\n\n# 6. KDE on Yau Tsim Mong\n\n\n::: {.cell}\n\n```{.r .cell-code}\nytm <- district_18 %>%\n  filter(ENAME == \"YAU TSIM MONG\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytm <- ytm %>%\n  st_transform(crs = 2326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytm <- as_Spatial(ytm)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytm_sp <- as(ytm, \"SpatialPolygons\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytm_owin <- as(ytm_sp, \"owin\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_ppp_jit <- rjitter(hk_cp_ppp, \n                      retry=TRUE, \n                      nsim=1, \n                      drop=TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_ytm_ppp <- hk_ppp_jit[ytm_owin]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhk_ytm_ppp.km = rescale(hk_ytm_ppp, 1000, \"km\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytmgaussian <- density(hk_ytm_ppp.km, \n                          sigma=bw.ppl, \n                          edge=TRUE, \n                          kernel=\"gaussian\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(ytmgaussian, file = \"data/rds/ytmgaussian.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytmgaussian <- read_rds(\"data/rds/ytmgaussian.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytmepanechnikov <- density(hk_ytm_ppp.km, \n                              sigma=bw.ppl, \n                              edge=TRUE, \n                              kernel=\"epanechnikov\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(ytmepanechnikov, file = \"data/rds/ytmepanechnikov.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytmepanechnikov <- read_rds(\"data/rds/ytmepanechnikov.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytmquartic <- density(hk_ytm_ppp.km, \n                         sigma=bw.ppl, \n                         edge=TRUE, \n                         kernel=\"quartic\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(ytmquartic, file = \"data/rds/ytmquartic.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytmquartic <- read_rds(\"data/rds/ytmquartic.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytmdisc <- density(hk_ytm_ppp.km, \n                      sigma=bw.ppl, \n                      edge=TRUE, \n                      kernel=\"disc\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(ytmdisc, file = \"data/rds/ytmdisc.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nytmdisc <- read_rds(\"data/rds/ytmdisc.rds\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}